########################################################
########################################################
#              ELECTRONICS DEFINITIONS                 #
########################################################
########################################################
%2LINK V2718 0 1 # V2718 CONET-VME BRIDGE crate 1
%2LINK V2718 0 0 # V2718 CONET-VME BRIDGE crate 0
%2LINK V2718 1 0 # BRIDGE FOR TIMING SENDER
%2BASE_ADDRESS  V1724 32100000 876 1 0 # module 0  -- Crate 2
%2BASE_ADDRESS  V1724 22230000 770 0 0 # module 0  -- Crate 1
%2BASE_ADDRESS  V2718 EE000000 1868 0 1 # timing sender -- Crate Controller

%1LINK V2718 0 0 #
%1BASE_ADDRESS V1724 22240000 749 0 0 #

#%3LINK V2718 0 1 #
%3LINK V2718 0 0 #
%3BASE_ADDRESS V1724 22250000 1009 0 0#
#%3BASE_ADDRESS V1724 22260000 0991 0 0#
#########################################################
#########################################################
#                    RUN OPTIONS
#########################################################
#########################################################
## BLT_SIZE {int}
##     Usage: define block transfer size
BLT_SIZE 524288

## RUN_START {int} {int}
##      Usage: define run start mode (0 - board internal 1-s-in)
##             and run start module by ID (module must be defined)
RUN_START 1 1868

## SUM_MODULE {int}
##      Usage: define a sum module by ID. This module will always be
##             digitized and will not be included in the event builder
#SUM_MODULE 991

## BASELINE_MODE {int}
##     Usage: 0 - no baselines determined. read from file if available.
##            1 - try to automatically determine baselines each time
##                boards are armed
BASELINE_MODE 1

## DDC10_Options {string1} {int1} {int2} {int3} {int4} {int5} {int6} {int7}
##      Usage: Define options for the ddc10 veto module
##              ADDRESS       MODE    SIGN     INT WINDOW     VETO DELAY     SIG THRESHOLD       INT THRESHOLD      WIDTH CUT
DDC10_OPTIONS 130.92.139.240    0      10        100            200                 150            20000             50

#########################################################
#########################################################
#                   OUPUT OPTIONS                       #
#########################################################
#########################################################

## WRITE_MODE {int}
##     Usage: define write mode. 0-no writing 1-to file 2-mongodb
WRITE_MODE 2

## MONGO_OPTIONS {string} {string} {int} {int} {int} {int}
##     Usage: first string mongodb address
##            second string collection name
##            first int 0-do not zip output 1-zip output
##            second int {int} max insert size
##            third int {int} write concern (0-normal 1-off)
##            fourth int {int} readout threshold (min. #events
##                          that need to be in buffer before write)
MONGO_OPTIONS lheppc42 data.test 1 5000 1 1

## PROCESSING_OPTIONS {int} {int}
##     Usage: first int defines the number of processing threads
##            second int defined the processing mode (0-none, 1-coarse,
              2-occurrence building old fw)
PROCESSING_OPTIONS 6 1

## OUTFILE_OPTIONS {string} {int} {int}
##     Usage: define options for file output. The first string argument
##            is the path. A wildcard means to end the file name with
##            a number determined by the current date/time.
##            The first int is used to define the compression. 1-on 0-off
##            The second int defines the number of events per file. -1
##            means unlimited.
OUTFILE_OPTIONS koData* 1 5000

#############################################################
#############################################################
#                      BOARD OPTIONS                        #
#############################################################
#############################################################

# -----------------------------------------------------------
# EF34 Configuration Reload Register
# -----------------------------------------------------------
#WRITE_REGISTER EF34 1 -1 -1 -1

# -----------------------------------------------------------
# EF24 Board reset
# -----------------------------------------------------------
WRITE_REGISTER EF24 0 -1 -1 -1 

# -----------------------------------------------------------
# EF1C BLT Event Number
#      Max num of events per BLT (mind the buffer size!)
# -----------------------------------------------------------
WRITE_REGISTER EF1C 5 -1 -1 -1 # max num of events per BLT (mind the buffer size!)

# -----------------------------------------------------------
# EF00 VME Control register
# -----------------------------------------------------------
WRITE_REGISTER EF00 10 -1 -1 -1 #Enable BERR

# -----------------------------------------------------------
# 8100 Acquisition control register
#             5: s-in control, 0: board control
# -----------------------------------------------------------
WRITE_REGISTER 8100 5 -1 -1 -1  # toggle to 5 for s-in control, 0 for board

# -----------------------------------------------------------
# 8120 Channel enable mast (FF for all channels)
# -----------------------------------------------------------
WRITE_REGISTER 8120 FF -1 -1 -1

# -----------------------------------------------------------
# 8114 Post trigger time window
#      Reg value is (Npost-Latency)/2. Latency is constant
# -----------------------------------------------------------
#WRITE_REGISTER 8114 2100 -1 -1 -1 #170us window after trigger
#WRITE_REGISTER 8114 6 -1 -1 -1 #short window after trigger
WRITE_REGISTER 8114 1F4 -1 -1 -1 #10us window after trigger

# -----------------------------------------------------------
# 810C Trigger source enable mask
# -----------------------------------------------------------
WRITE_REGISTER 810C C0000000  -1 -1 -1 # Software + External

# -----------------------------------------------------------
# 800C Buffer organization (Num Buffers = 2^N)
# -----------------------------------------------------------
# 4     No. of Blocks:   16     Block Size=64k  Samples/Block: 32k
# 5     No. of Blocks:   32     Block Size=32k  Samples/Block: 16k
# A     No. of Blocks: 1024     Block Size=1k   Samples/Block: 512
# 9     No. of Blocks:  512                     Samples/Block: 1k 
# ------------------------------------------------------------
#WRITE_REGISTER 800C 4 -1 -1 -1
#WRITE_REGISTER 800C A -1 -1 -1 #short window
WRITE_REGISTER 800C 7 -1 -1 -1 #medium window

# -----------------------------------------------------------
# 8098 DAC configuration for each channel 
# (1000 = negative unipolar + offset, 8000=bipolar, F000=positive
# -----------------------------------------------------------
WRITE_REGISTER 8098 2000 -1 -1 -1

# -----------------------------------------------------------
# 8020 Custom event size (number of memory locations)
#      0 - no custon size
# -----------------------------------------------------------
WRITE_REGISTER 8020 0 -1 -1 -1
#WRITE_REGISTER 8020 A0 -1 -1 -1

# -----------------------------------------------------------
# 8028 Zero Suppression look back and look forward (# mem locations)
# -----------------------------------------------------------
WRITE_REGISTER 8028 190019 -1 -1 -1 # 25 words = 50 samples
#WRITE_REGISTER 8028 190009 -1 -1 -1 #just 2 words=4 samples
#WRITE_REGISTER 8028 00320005 -1 -1 -1


# -----------------------------------------------------------
# 8024 Zero suppression over threshold (number of memory locations)
#      00002710 - positive polarity
#      80002710 - negative polarity
#      80003E58 - same thresh to al boards, 16000-40 = 0x3E58
# -----------------------------------------------------------
WRITE_REGISTER 8024 80003E58 -1 -1 -1 # write the same threshold to all boards
#WRITE_REGISTER 8024 80003E76 -1 -1 -1 # write the same threshold to all boards


# -----------------------------------------------------------
# EF14 Interrupt status ID
# -----------------------------------------------------------
WRITE_REGISTER EF14 55AA -1 -1 -1 # Interrupt

# -----------------------------------------------------------
# EF18 Interrupt event number
# -----------------------------------------------------------
WRITE_REGISTER EF18 0 -1 -1 -1 # Interrupt when 1 event stored

# -----------------------------------------------------------
# 8000 Channel configuration reload register
#
# Bit 1 = trigger overlapped
# Bit 3 = test waveform 
# Bit 4 = sequential readout (must be 1)
# Bit 6 = local trigger polarity (0=rising, 1=falling)
# Bit 7 = enable copy of the signal for analog sum
# Bit 11= sample packing 2.5 (0=disabled, 1=enabled) (V1720 only)
# Bit 12= DES Mode enable (V1731 only)
# Bit 19:16= Zero suppression mode (0=noZS, 1=ZS integral, 2=ZS zip, ZS threshold
# -----------------------------------------------------------
WRITE_REGISTER 8000 200D0 -1 -1 -1 # ZS ZIP+ Falling + Sequential + External signal + Non Overlap Triggers + AnalogSum
#WRITE_REGISTER 8000 D0 #No ZS, falling+sequential+ext signal+ non overlap

WRITE_REGISTER 811C 0 -1 -1 -1

# -----------------------------------------------------------
# 8144 DAC monitor mode
# -----------------------------------------------------------
#WRITE_REGISTER 8144 0 -1 -1 -1 #TRIGGER MAJORITY MODE
WRITE_REGISTER 8144 2 -1 -1 -1 # ANALOG MONITOR MODE

# -----------------------------------------------------------
# 8150 Analog monitor settings
#      Bit [7:0]: Analog sum enable mask (analog out is sum of enabled channels)
#      Bit [19:8]: Offset (bit 19 is sign (0-pos), but 18:8 is offset
#                  added (or sub depending on sign) to the sum of the channels
#      Bit [21:20]: Magnify (digital gain factor 0->1x, 1->2x, 2->4x, 3->8x)
# -----------------------------------------------------------
WRITE_REGISTER 8150 8009ECFF -1 -1 -1 # all channels enabled, magnify=x1, offset=-240mV=492cnts

# -----------------------------------------------------------
# 8080 Channel threshold set for majority or internal trigger
# -----------------------------------------------------------
WRITE_REGISTER 8080 2E00 -1 -1 -1 # BROADCAST

# -----------------------------------------------------------
# 8084 2*n samples over/under threshold (used to generate trigger)
# -----------------------------------------------------------
WRITE_REGISTER 8084 2 -1 -1 -1 #BROADCAST

# -----------------------------------------------------------
# 811C Front panel I/0 register settings
# -----------------------------------------------------------
WRITE_REGISTER 811C 40 -1 -1 -1

#STUFF THAT WAS IN XML
#WRITE_REGISTER 800C 9 -1 -1 -1
#WRITE_REGISTER 8114 DF -1 -1 -1



