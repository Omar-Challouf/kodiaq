<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DAQ Options &mdash; kodiaq 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bstheme.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/theme.js"></script>
    <link rel="top" title="kodiaq 1.0 documentation" href="index.html" />
    <link rel="next" title="Data Formats" href="protocols.html" />
    <link rel="prev" title="Deployment of the Full System" href="deployment.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">
        kodiaq</a>
      <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
    </div>
    
    <div class="collapse navbar-collapse"><!-- nav-collapse">-->
      <ul class="nav navbar-nav pull-right">
        <!--<li class="divider-vertical"></li>  -->
        
        
        
        
         
            

<li>
    <a href="deployment.html" title="Previous Chapter: Deployment of the Full System"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Deployment of th...</span>
    </a>
  </li>
  <li>
    <a href="protocols.html" title="Next Chapter: Data Formats"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Data Formats &raquo;</span>
    </a>
  </li>
          
        
        
        
        
      </ul>
      
      <!--          
		    
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
		     -->
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
      <div class="col-md-3" id="leftCol">
        <!--<div id="sidebar" class="bs-sidenav" role="complementary"> -->
	<br><br>
	<ul id="sidebar" class="nav nav-stacked"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinterface.html">A Tour of the Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of the standalone reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Standalone Reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment of the Full System</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">DAQ Options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-syntax">General Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#electronics-definitions">Electronics Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-options">Run Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-options">Output Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vme-options">VME Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">Data Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoringdatabase.html">Monitoring DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoringdatabase.html#run-modes">Run Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="jargon.html">Jargon Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>

<!--<li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#scope-of-the-program">Scope of the program</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#use-guidelines">Use Guidelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="webinterface.html">A Tour of the Web Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="webinterface.html#introduction">Introduction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of the standalone reader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#fetching-the-source-code">Fetching the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#prerequisites-for-installation">Prerequisites for installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#how-to-install">How to install</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Standalone Reader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#special-options-for-standalone-mode">Special options for standalone mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment of the Full System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#summary-of-dependencies-per-module">Summary of Dependencies per Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#deployment-step-by-step">Deployment, Step by Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#general-network-structure">General network structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#koslave">koSlave</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#komaster">koMaster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="deployment.html#run-modes">Run Modes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">DAQ Options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-syntax">General Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#electronics-definitions">Electronics Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-options">Run Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-options">Output Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vme-options">VME Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">Data Formats</a><ul>
<li class="toctree-l2"><a class="reference internal" href="protocols.html#mongodb">Mongodb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="protocols.html#run-control-document">Run Control Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="protocols.html#data-documents">Data Documents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="monitoringdatabase.html">Monitoring DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoringdatabase.html#run-modes">Run Modes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="monitoringdatabase.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jargon.html">Jargon Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>
</ul>
</li> -->
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </ul>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="daq-options">
<h1>DAQ Options<a class="headerlink" href="#daq-options" title="Permalink to this headline">¶</a></h1>
<p>DAQ options are stoed in .ini files. There are two types of DAQ options
files. Static options are defined for the master and slave programs
upon program start and remain the same for the life of the program.
These files deal with master/slave connectivity and database addresses.
Configuration of these files is defined in the &#8216;deployment&#8217; section.</p>
<p>This section deals with the &#8216;run modes&#8217; ini files that define the settings
for a particular run. These settings are reset each run and are designed
to chage from run to run.</p>
<p>The .ini files are in json format. This allows the files to be easily
stored in a MongoDB collection in the full system deployment, or simply edited as
text files for a local deployment.</p>
<p>The design of the program is that these files will be defined by
developers while end users will have to option to pick from several
pre-defined modes.</p>
<p>It is important to not edit these files unless you know what you are
doing. There is only a limited amount of sanity checking done on the
input of these files and improper editing could break the DAQ. If you
are fortunate it will break in a way that is obvious, if you are
unlucky you might not even notice. Particularly the VME options are
passed to the boards <em>directly as printed in the order they are printed</em>
in the .ini file. Improper setting of any of these options is very
difficult to debug.</p>
<p>That said, if you are a power user please read on for an explanation
of the options available.</p>
<div class="section" id="general-syntax">
<h2>General Syntax<a class="headerlink" href="#general-syntax" title="Permalink to this headline">¶</a></h2>
<p>The .ini file is mostly passed verbatim to the slaves when a run mode is
selected. However a limited amount of parsing is done.</p>
<p>Options are given in JSON format. If the ini file is not valid JSON
it will be rejected. You can check if you write valid JSON by using a
JSON validator, for example www.jsonlint.com. In our system we allow our
web view to validate the JSON before putting it into the database.</p>
<p>Option names must exactly match one of the pre-defined
options (case sensitive). The arguments can be strings, bools, or numeric.
Additionally, nested objects are allowed and are used for register, link,
and board definition.</p>
<p>In certain cases there are options that should only go to one slave
PC. An example of this is the electronics definitions. The readout
electronics are hard-wired to the slave PCs and the cabling must be
defined in the options file. Most options allow for this directly
within the format.</p>
</div>
<div class="section" id="electronics-definitions">
<h2>Electronics Definitions<a class="headerlink" href="#electronics-definitions" title="Permalink to this headline">¶</a></h2>
<p>CAEN V1724 digitizers can be read out in one of two ways: either via a
single optical link to a V2718 crate controller, which reads the
boards out through the VME backend, or via the optical links on the
front of the V1724 digitizers themselves. When reading out through the
crate controller, rates are somewhat limited, presumably either
through latency in the VME backplane or a delay introduced when
processing the data in the crate controller module (this is a
closed-source, commercial system so we are not sure which). Maximum
throughput in this mode is around 30 MB/s depending on data type and
options. Therefore it is recommended to always connect the DAQ in
&#8220;daisy-chain mode&#8221; if possible. Though reading out via the crate
controller is possible with kodiaq, this guide will only cover configuring
the DAQ for readout through the optical links on the V1724 boards
themselves (where speeds of up to 90MB/s have been observed).</p>
<p>When connecting the boards in &#8220;daisy-chain&#8221; mode, optical cables are
used to hook the boards in series to a single optical input on the
A2818 or A3818 PCI(e) card. Up to 8 digitizers can be connected to a
single optical port, meaning an A2818 supports up to 8 digitizers
while an A3818 can support up to 32. Keep in mind the readout speed of
a single slave is still capped at 70-90 MB/s (depending on options),
so it is generally advantageous to spread the digitizers out over
several machines.</p>
<p>The software-side configuration is a bit counter intuitive at first
for daisy-chain mode, but it follows the convention set in the CAENVME
library. Two variables must be defined, a LINK and a BASE_ADDRESS
(board). When the boards are connected in daisy-chain mode, each
digitizer has its own LINK defined, as opposed to when the boards are
read out via the crate controller, in which case they share a link.</p>
<p>The syntax for defining a link is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
 <span class="s">&quot;links&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;V2718&quot;</span><span class="p">,</span> <span class="c"># or &quot;V1718&quot; if you use USB</span>
     <span class="s">&quot;reader&quot;</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>   <span class="c"># ID of reader</span>
     <span class="s">&quot;crate&quot;</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>    <span class="c"># CAEN crate number</span>
     <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="n">Int</span>      <span class="c"># Link index (physically on the optical card)</span>
    <span class="p">},</span>
    <span class="o">...</span> <span class="c">#more links</span>
    <span class="p">]</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>Keep in mind that the CAEN software was designed first for reading out
via the crate controller and extended to read out via the V1724
optical link directly and this will make a bit more sense.</p>
<blockquote>
<div><ul class="simple">
<li>link defines a JSON list field containing a sub-dictionary for
each link definition.</li>
<li>&#8220;type&#8221; is the type of optical link. We will always use
&#8216;V2718&#8217; type links, even when reading out via the V1724. If you have
a system that uses the USB adapter you might want &#8220;V1718&#8221;.</li>
<li>&#8220;link&#8221; (in the sub-object) is the ID of the optical port the cable is
hooked up to. This is always 0 for the A2818 since it just has one
port but can be 0-3 for the A3818.</li>
<li>&#8220;crate&#8221; is the crate ID. In daisy chain mode each digitizer
gets its own crate ID. Of course when reading out through a
crate controller this made more sense, since there was one crate
controller per crate. When reading out via the digitizer itself
just think of this as an integral identifier. Note when reading out
via optical link only the link/crate identifier is used by the CAEN
drivers to identify the board. The VME address is not queried.</li>
</ul>
</div></blockquote>
<p>Once a link is defined, the software has to know what type of board is
hooked up. So far V1724 digitizers and V2718 crate controllers are
supported. Actually, only one V2718 module is required for the entire
DAQ, though more can be supported if needed.</p>
<p>The syntax for defining a module is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;boards&quot;</span><span class="p">:</span> <span class="p">[</span>
   <span class="p">{</span>
     <span class="s">&quot;crate&quot;</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
     <span class="s">&quot;serial&quot;</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
     <span class="s">&quot;reader&quot;</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
     <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">Sting</span><span class="p">,</span>
     <span class="s">&quot;vme_address&quot;</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
     <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="n">Int</span>
   <span class="p">},</span>
   <span class="o">...</span> <span class="c">#more boards</span>
   <span class="p">]</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>The definitions of these are as follows.</p>
<blockquote>
<div><ul class="simple">
<li>&#8220;board&#8221; is a list field containing sub-dictionaries defining each board.</li>
<li>&#8220;crate&#8221; is the crate number assigned in the corresponding &#8216;link&#8217; command.</li>
<li>&#8220;serial&#8221; is a unique identification number for the board.
Each board has a serial number printed on the front and it is
recommended to use that.</li>
<li>&#8220;reader&#8221; is the ID of the reader to which the board is connected</li>
<li>&#8220;type&#8221; gives the type of the board. At the moment only
the types &#8216;V1724&#8217; or &#8216;V2718&#8217; are supported.</li>
<li>&#8220;vme_address&#8221; is the board&#8217;s VME address as a string (in hex). You can
set this using radial dials on the board itself. For example if you set
a digitizer to &#8220;EEFF&#8221; then this option is &#8220;EEFF0000&#8221;.</li>
<li>&#8220;link&#8221; as before is the link over which the board is connected.</li>
</ul>
</div></blockquote>
<p>The following is an example initialization using one slave PCs with ID 2.
It has one digitizers and one crate controller hooked up
via separate links on an A3818.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
   <span class="s">&quot;boards&quot;</span><span class="p">:</span> <span class="p">[</span>
   <span class="p">{</span>
    <span class="s">&quot;crate&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;serial&quot;</span><span class="p">:</span> <span class="s">&quot;2374&quot;</span><span class="p">,</span>
    <span class="s">&quot;reader&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;V2718&quot;</span><span class="p">,</span>
    <span class="s">&quot;vme_address&quot;</span><span class="p">:</span> <span class="s">&quot;DC000000&quot;</span><span class="p">,</span>
    <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="mi">0</span>
   <span class="p">},</span>
   <span class="p">{</span>
    <span class="s">&quot;crate&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;serial&quot;</span><span class="p">:</span> <span class="s">&quot;1254&quot;</span><span class="p">,</span>
    <span class="s">&quot;reader&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;V1724&quot;</span><span class="p">,</span>
    <span class="s">&quot;vme_address&quot;</span><span class="p">:</span> <span class="s">&quot;800D0000&quot;</span><span class="p">,</span>
    <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="mi">1</span>
   <span class="p">}</span>
   <span class="p">],</span>
   <span class="s">&quot;links&quot;</span><span class="p">:[</span>
   <span class="p">{</span>
    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;V2718&quot;</span><span class="p">,</span>
    <span class="s">&quot;reader&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;crate&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="mi">0</span>
   <span class="p">},</span>
   <span class="p">{</span>
    <span class="s">&quot;crate&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;V2718&quot;</span><span class="p">,</span>
    <span class="s">&quot;reader&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="mi">1</span>
   <span class="p">}</span>
   <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For standalone deployments containing only one slave, the &#8220;reader&#8221; identifier
is not used. Additionally any &#8220;%n&#8221; lines must be removed.
This is because for a standalone deployment the options file
is not run through the parser that removes and strips this identifier.</p>
</div>
<div class="section" id="run-options">
<h2>Run Options<a class="headerlink" href="#run-options" title="Permalink to this headline">¶</a></h2>
<p>The user can define several options related to the run. These are
options for kodiaq itself. To control the board internal options, see
the section on board options.</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>blt_size {int}</strong>
Size of a block transfer. The default is the maximum size of
8 MB. There is probably no reason to change this unless you use a
different model of digitizer.</p>
</li>
<li><p class="first"><a href="#id1"><span class="problematic" id="id2">**</span></a>run_start {int} **
Define how a run is started. 0 means via VME register and 1 means
via s-in. Option 1 should always be used if you have multiple
digitizers as it synchronizes the clocks of the digitizers.</p>
</li>
<li><p class="first"><a href="#id3"><span class="problematic" id="id4">**</span></a>run_start_module {int} **
If run_start is set to &#8216;1&#8217;, this option provides the ID of the crate
controller that will be used to start the run. Ignored if run_start is 0.</p>
</li>
<li><p class="first"><strong>baseline_mode {int}</strong>
kodiaq contains an automated routine to adjust the
baselines so that the full dynamic range of each input channel is
used. This option lets the user set when that should happen.
Giving the argument &#8216;0&#8217; means the baselines are not determined.
They are set via the values given in the files in
src/slave/baselines. The argument &#8216;1&#8217; tells the program to
automatically determine baselines whenever the DAQ is armed.</p>
</li>
<li><p class="first"><strong>ddc10_options</strong>
If a DDC10 high energy veto module is used, this line lets you
define the options. There is one string followed by fifteen
integer arguments. A detailed explanation of the arguments
appears in the documentation for the custom ddc10 firmware. The arguments are:
* address: address of the module (ip)
* sign: sign
* window: integration window
* delay: veto delay
* signal_threshold: signal threshold
* integration_threshold: integration threshold
* width_cut: width cut
* rise_time_cut: rise time cut
* component_status: component status
* parameter_n: where n = 0, 1, 2, or 3. 4 parameters for veto</p>
<blockquote>
<div><p>function (see ddc10 docs)</p>
</div></blockquote>
<ul class="simple">
<li>outer_ring_factor: outer ring factor</li>
<li>inner_ring_factor: inner ring factor</li>
<li>prescaling: prescaling</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>An example of how these options appears in the .ini file is shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
   <span class="s">&quot;blt_size&quot;</span><span class="p">:</span> <span class="mi">524288</span><span class="p">,</span>
   <span class="s">&quot;run_start_module&quot;</span><span class="p">:</span> <span class="mi">2374</span><span class="p">,</span>
   <span class="s">&quot;run_start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s">&quot;DDC-10&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s">&quot;signal_threshold&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
     <span class="s">&quot;address&quot;</span><span class="p">:</span> <span class="s">&quot;130.92.139.240&quot;</span><span class="p">,</span>
     <span class="s">&quot;prescaling&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
     <span class="s">&quot;delay&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
     <span class="s">&quot;component_status&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">&quot;inner_ring_factor&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">&quot;rise_time_cut&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
     <span class="s">&quot;parameter_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s">&quot;window&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
     <span class="s">&quot;parameter_1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s">&quot;outer_ring_factor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s">&quot;integration_threshold&quot;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span>
     <span class="s">&quot;parameter_3&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
     <span class="s">&quot;sign&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">&quot;width_cut&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
     <span class="s">&quot;parameter_2&quot;</span><span class="p">:</span> <span class="mi">0</span>
   <span class="p">},</span>
   <span class="s">&quot;baseline_mode&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="output-options">
<h2>Output Options<a class="headerlink" href="#output-options" title="Permalink to this headline">¶</a></h2>
<p>The output options all relate to where the data is pushed to. Not all
of these options are required, but be sure to include the options
related to your chosen write mode.</p>
<blockquote>
<div><blockquote>
<div><ul>
<li><p class="first"><strong>write_mode {int}</strong>
Define what is done with the data. 0 - no writing (test mode). 1
- write to file (not yet supported). 2 - write to mongodb. If you
choose mode &#8216;2&#8217;, make sure the MONGO_OPTIONS are defined.</p>
</li>
<li><p class="first"><strong>compression {int}</strong> turns compression on (1) or off (0). Compression
is done with Google&#8217;s snappy algorithm.</p>
</li>
<li><p class="first"><strong>mongo_address {string}</strong> This is the mongoDB connection string
for your database deployment. It must be a valid connection string
readable by the C++ driver. Strings are checked for plausibility
before a connection is attempted (using the built-in isValid() call).
Please note that multiple mongos instances are not supported as a
fallback case. The only instance where you can have multiple servers
defined in the connection string is for a replica set.</p>
<p>Here&#8217;s are a couple examples, for a standalone server and a replica:</p>
<div class="highlight-python"><div class="highlight"><pre>mongodb://user:pass@server:port/DB
mongodb://user:pass@server0:port0,server1:port1,server2:port2/DB?replicaSet=set_name
</pre></div>
</div>
</li>
<li><p class="first"><strong>mongo_database {string}</strong> defines a database name for output. In case
you use authentication in your connection string this must be identical
to your authentication database.</p>
</li>
<li><p class="first"><strong>mongo_collection {string}</strong> defines a collection name. If you end
the collection name with a wildcard (for example data*) the software
will automatically assign a date/time string for the end of the collection
name of form: data_YYMMDD_HHMM.</p>
</li>
<li><p class="first"><strong>mongo_min_insert_size {int}</strong> gives the minimum number of BSON documents
that must be collected before an insert is performed. kodiaq uses
bulk inserts to put data into mongodb. This means each insert is
actually a vector of  BSON documents.</p>
</li>
<li><p class="first"><strong>mongo_write_concern {int}</strong> defines the write concern for mongo.
Putting this to  normal mode (set 1) turns write concern on. This
means the client will  wait for a reply from the mongo database after
writing. On the one hand, this is very good since it confirms an
insert made it to mongo. On the other hand it is very slow. Turning
the option of (value 0) is required for high-rate data-taking.</p>
</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first"><strong>processing_mode {int}</strong> defines the block splitting mode. This is a
reformatting of the data before it is put into the database. The
options are:
* 0 - No block splitting. Each mongodb document will contain an</p>
<blockquote>
<div><p>entire block transfer which could contain one or many event headers.</p>
</div></blockquote>
<ul class="simple">
<li>1 - coarse block splitting. Splits the block into separate events.
This is for the default board firmware where each event is a trigger.
One mongodb document contains data from all the channels for this trigger.</li>
<li>2 - fine block splitting. Splits the block into separate events with one
event per channel.</li>
<li>3 - Same as 2 but even further splits channels into occurrences. Only
works with the default firmware with zero-length-encoding enabled.
In this mode each zero-length-encoded chunk of data is its own doc.
This meant to emulate the custom firmware.</li>
<li>4 - header extraction for custom firmware. Parses custom firmware events
and puts each channel into its own document. The document timestamp is
taken from the channel in this case (note the header as in the other modes).</li>
</ul>
</li>
<li><p class="first"><strong>processing_readout_threshold {int}</strong> is the readout threshold.
This defines a minimum number of documents that must be read before
being processed. Can be tuned to achieve maximum write speeds in cases
where rates fluctuate. At the end of a run the entire buffer will be
written out regardless of whether this threshold was reached or not.</p>
</li>
<li><p class="first"><strong>processing_num_threads {int}</strong> defines how many parallel threads
should be used for data parsing. It isn&#8217;t suggested to make this
a ridiculous number. The boards can only be read one at a time (there
is a mutex-protected call to the CAEN block transfer function). The
goal at high rates is to have the boards always being read. Therefore
enough processing threads (and processing power) must exist to do all
of the data parsing, BSON creation, and data input. As a rule this
number is usually set based on the number of threads in the processor
on the computer.</p>
</li>
<li><p class="first"><strong>occurrence_integral {int}</strong> defines whether or not to compute an integral
for each occurrence and store it in the documents. If this option is set to
zero, no integral is computed. If the option is non-zero it defines the number
of bins to use for the pre-sample baseline. This should usually be the
same as the pre-trigger window set via VME option.
NOTE: This number must be even and &gt;=2. If the number is non-even it will be
reduced by one. If the number is &lt;2 it will be set to zero. If the number is larger
than the sample size you will use the entire sample to determine the baseline
and will get bad results.</p>
</li>
</ul>
</div></blockquote>
<ul>
<li><dl class="first docutils">
<dt><strong>lite_mode {int}</strong> defines whether to store data or not. It is possible to run</dt>
<dd><p class="first last">the DAQ in a sort of &#8216;lite_mode&#8217; where the raw data for each occurrence is not stored. Rather
one can store the occurrence_integral and the meta-data. If storage space is an issue
this may be a reasonable option to do many types of analysis while greatly reducing the data size.</p>
</dd>
</dl>
</li>
</ul>
<p>An example of how these options appear in the .ini file is shown
below.</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &quot;write_mode&quot;: 0,

    &quot;mongo_collection&quot;: &quot;data*&quot;,
    &quot;mongo_write_concern&quot;: 0,
    &quot;mongo_min_insert_size&quot;: 1,
    &quot;mongo_database&quot;: &quot;raw&quot;,
    &quot;mongo_address&quot;: &quot;xedaq00&quot;

    &quot;processing_readout_threshold&quot;: 0,
    &quot;processing_num_threads&quot;: 8,

    &quot;compression&quot;: 1
}
</pre></div>
</div>
</div>
<div class="section" id="vme-options">
<h2>VME Options<a class="headerlink" href="#vme-options" title="Permalink to this headline">¶</a></h2>
<p>The VME options allow setting of the VME registers in the V1724
modules. This allows direct control of the acquisition system. Some of
these settings are absolutely required to remain at their default
values, others can be tuned based on the desired performance of the
DAQ. Please only change these values if you know what you are doing.
Problems with incorrect settings in these registers are very hard to
debug.</p>
<p>Two things should be kept in mind:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The VME options are loaded to the boards in the order they are
listed in the .ini file.</li>
<li>Absolutely no sanity checking is done on these options. The
value passed as an argument will be directly set to the
digitizers.</li>
</ol>
</div></blockquote>
<p>The general format of a VME option setting is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>&quot;registers&quot;: [
  {
    &quot;board&quot;: String,
    &quot;comment&quot;: String,
    &quot;value&quot;: String,
    &quot;register&quot;: String
  },
... #more options
]
</pre></div>
</div>
<p>Where the values of the parameters are:</p>
<blockquote>
<div><ul class="simple">
<li><strong>registers</strong> is the lag that identifies a list of register settings.</li>
<li><strong>register</strong> is a hexidecimal value of the register to set. These
are sixteen-bit (four word) values and are added to the board
VME address to write to a specific memory register of a specific board.</li>
<li><strong>board</strong> is an ID number of a board in case it is desired
to write the option just to a single board. -1 means all boards.</li>
<li><strong>value</strong> is the register value in hex.</li>
<li><strong>comment</strong> is a user comment that can be helpful for keeping things straight.</li>
</ul>
</div></blockquote>
<p>Note that &#8216;register&#8217; and &#8216;value&#8217; are hex numbers but should be given as strings.
The strings are parsed into unsigned integers in the code.</p>
<p>Here are a few examples of how to use the command.</p>
<p>To write the value of 10 to register EF00 for all boards:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;board&quot;</span><span class="p">:</span> <span class="s">&quot;-1&quot;</span><span class="p">,</span>
    <span class="s">&quot;comment&quot;</span><span class="p">:</span> <span class="s">&quot;BERR register, 10=enable BERR&quot;</span><span class="p">,</span>
    <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="s">&quot;10&quot;</span><span class="p">,</span>
    <span class="s">&quot;register&quot;</span><span class="p">:</span> <span class="s">&quot;EF00&quot;</span>
 <span class="p">},</span>
</pre></div>
</div>
<p>To write the same value to the same register only for board 800:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;board&quot;</span><span class="p">:</span> <span class="s">&quot;800&quot;</span><span class="p">,</span>
    <span class="s">&quot;comment&quot;</span><span class="p">:</span> <span class="s">&quot;BERR register, 10=enable BERR&quot;</span><span class="p">,</span>
    <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="s">&quot;10&quot;</span><span class="p">,</span>
    <span class="s">&quot;register&quot;</span><span class="p">:</span> <span class="s">&quot;EF00&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Generally, the same options should be written to all digitizers so
setting the board, crate, and link IDs to -1 is advisable. The
exception to this is the acquisition monitor board, which may require
some special settings.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Daniel Coderre.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>