
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DAQ Options &mdash; kodiaq 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="kodiaq 0.9 documentation" href="index.html" />
    <link rel="next" title="Data Formats" href="protocols.html" />
    <link rel="prev" title="Deployment of the Full System" href="deployment.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          kodiaq</a>
        <span class="navbar-text navbar-version pull-left"><b>0.9</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">kodiaq <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#scope-of-the-program">Scope of the program</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#use-guidelines">Use Guidelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of the client UI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#fetching-the-source-code">Fetching the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#compiling-the-ui-module">Compiling the UI module</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#running-the-code">Running the code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Client Program</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#daq-status-window">DAQ Status window</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#control-window">Control Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#messages-window">Messages Window</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment of the Full System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#summary-of-dependencies-per-module">Summary of Dependencies per Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#deployment-step-by-step">Deployment, Step by Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#koslave">koSlave</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#komaster">koMaster</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#deployment-of-the-standalone-slave-module">Deployment of the Standalone Slave Module</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">DAQ Options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-syntax">General Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#electronics-definitions">Electronics Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-options">Run Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-options">Output Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vme-options">VME Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">Data Formats</a><ul>
<li class="toctree-l2"><a class="reference internal" href="protocols.html#output-to-mongodb">Output to Mongodb</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jargon.html">Jargon Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">DAQ Options</a><ul>
<li><a class="reference internal" href="#general-syntax">General Syntax</a></li>
<li><a class="reference internal" href="#electronics-definitions">Electronics Definitions</a></li>
<li><a class="reference internal" href="#run-options">Run Options</a></li>
<li><a class="reference internal" href="#output-options">Output Options</a></li>
<li><a class="reference internal" href="#vme-options">VME Options</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="deployment.html" title="Previous Chapter: Deployment of the Full System"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Deployment of th...</span>
    </a>
  </li>
  <li>
    <a href="protocols.html" title="Next Chapter: Data Formats"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Data Formats &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/options.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">kodiaq <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#scope-of-the-program">Scope of the program</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#use-guidelines">Use Guidelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of the client UI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#fetching-the-source-code">Fetching the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#compiling-the-ui-module">Compiling the UI module</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#running-the-code">Running the code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Client Program</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#daq-status-window">DAQ Status window</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#control-window">Control Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#messages-window">Messages Window</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment of the Full System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#summary-of-dependencies-per-module">Summary of Dependencies per Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#deployment-step-by-step">Deployment, Step by Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#koslave">koSlave</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#komaster">koMaster</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html#deployment-of-the-standalone-slave-module">Deployment of the Standalone Slave Module</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">DAQ Options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-syntax">General Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#electronics-definitions">Electronics Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-options">Run Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-options">Output Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vme-options">VME Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">Data Formats</a><ul>
<li class="toctree-l2"><a class="reference internal" href="protocols.html#output-to-mongodb">Output to Mongodb</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jargon.html">Jargon Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>
</ul>
</li><ul>
<li><a class="reference internal" href="#">DAQ Options</a><ul>
<li><a class="reference internal" href="#general-syntax">General Syntax</a></li>
<li><a class="reference internal" href="#electronics-definitions">Electronics Definitions</a></li>
<li><a class="reference internal" href="#run-options">Run Options</a></li>
<li><a class="reference internal" href="#output-options">Output Options</a></li>
<li><a class="reference internal" href="#vme-options">VME Options</a></li>
</ul>
</li>
</ul>

<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="daq-options">
<h1>DAQ Options<a class="headerlink" href="#daq-options" title="Permalink to this headline">¶</a></h1>
<p>The DAQ options are stored in .ini files, usually found in
src/master/data/RunModes and linked in the RunModes.ini file. The
design of the program is that these files will be defined by
developers while end users will have to option to pick from several
pre-defined modes. A suggested use of the end system is to have the
.ini files and the RunModes.ini file with permissions set to read only
for normal users.</p>
<p>It is important to not edit these files unless you know what you are
doing. There is only a limited amount of sanity checking done on the
input of these files and improper editing could break the DAQ. If you
are fortunate it will break in a way that is obvious, if you are
unlucky you might not even notice. Particularly the VME options are
passed to the boards <em>directly as printed</em> in the .ini file. Improper
setting of any of these options is very difficult to debug and there
is rarely any reason to change them.</p>
<p>That said, read on for an explanation of the options available.</p>
<div class="section" id="general-syntax">
<h2>General Syntax<a class="headerlink" href="#general-syntax" title="Permalink to this headline">¶</a></h2>
<p>The .ini file is mostly passed verbatim to the slaves when a run mode is
selected. However a limited amount of parsing is done.</p>
<p>Options lines follow the format</p>
<div class="highlight-python"><pre>OPTION_NAME ARG_1 ARG_2 ... ARG_N</pre>
</div>
<p>where the OPTION_NAME must exactly match one of the pre-defined
options (case sensitive). The arguments can be strings or numeric and
are separated by spaces. If not enough arguments are provided, the
option is ignored. If too many arguments are provided, only the first
N arguments are read in, where N is the number of arguments expected.
The option string is ended with a line break.</p>
<p>In certain cases there are options that should only go to one slave
PC. An example of this is the electronics definitions. The readout
electronics are hard-wired to the slave PCs and the cabling must be
defined in the options file. In order to send a particular option to
just one slave, the line should be preceeded by &#8216;%n&#8217; (without quotes)
where n is the id of the slave as defined in its own network interface
constructor. The &#8216;%&#8217; symbol must be the first symbol in the line as
the master will parse the files searching specifically for this
character. Please don&#8217;t start any lines with the &#8216;%&#8217; symbol and then
not follow them with an integer slave ID. Also, currently only up to
10 slaves are supported numbered 0-9.</p>
<p>Also of note, commenting can be done with the &#8216;#&#8217; symbol. Any lines
preceeded by a &#8216;#&#8217; will be transmitted to the slaves but ignored by
the parser.</p>
</div>
<div class="section" id="electronics-definitions">
<h2>Electronics Definitions<a class="headerlink" href="#electronics-definitions" title="Permalink to this headline">¶</a></h2>
<p>CAEN V1724 digitizers can be read out in one of two ways: either via a
single optical link to a V2718 crate controller, which reads the
boards out through the VME backend, or via the optical links on the
front of the V1724 digitizers themselves. When reading out through the
crate controller, rates are severely limited, presumably either
through latency in the VME backplane or a delay introduced when
processing the data in the crate controller module (this is a
closed-source, commercial system so we are not sure which). Maximum
throughput in this mode is around 30 MB/s depending on data type and
options. Therefore it is recommended to always connect the DAQ in
&#8220;daisy-chain mode&#8221; if possible. Though reading out via the crate
controller is possible with kodiaq, this guide will only cover configuring
the DAQ for readout through the optical links on the V1724 boards
themselves (where speeds of up to 90MB/s have been observed).</p>
<p>When connecting the boards in &#8220;daisy-chain&#8221; mode, optical cables are
used to hook the boards in series to a single optical input on the
A2818 or A3818 PCI(e) card. Up to 8 digitizers can be connected to a
single optical port, meaning an A2818 supports up to 8 digitizers
while an A3818 can support up to 32. Keep in mind the readout speed of
a single slave is still capped at 70-90 MB/s (depending on options),
so it is generally advantageous to spread the digitizers out over
several machines.</p>
<p>The software-side configuration is a bit counter intuitive at first
for daisy-chain mode, but it follows the convention set in the CAENVME
library. Two variables must be defined, a LINK and a BASE_ADDRESS
(board). When the boards are connected in daisy-chain mode, each
digitizer has its own LINK defined, as opposed to when the boards are
read out via the crate controller, in which case they share a link.</p>
<p>The syntax for defining a link is</p>
<div class="highlight-python"><pre>LINK {type string} {optical port int} {crate int}</pre>
</div>
<p>Keep in mind that the CAEN software was designed first for reading out
via the crate controller and extended to read out via the V1724
optical link directly and this will make a bit more sense.</p>
<blockquote>
<div><ul class="simple">
<li>LINK is the control word that tells kodiaq what the option is</li>
<li>{type string} is the type of optical link. We will always use
&#8216;V2718&#8217; type links, even when reading out via the V1724.</li>
<li>{optical port int} is the ID of the optical port the cable is
hooked up to. This is always 0 for the A2818 since it just has one
port but can be 0-3 for the A3818.</li>
<li>{crate int} is the crate ID. In daisy chain mode each digitizer
gets its own crate ID. Of course when reading out through a
crate controller this made more sense, since there was one crate
controller per crate. When reading out via the digitizer itself
just think of this as an integral identifier.</li>
</ul>
</div></blockquote>
<p>Once a link is defined, the software has to know what type of board is
hooked up. So far V1724 digitizers and V2718 crate controllers are
supported. Actually, only one V2718 module is required for the entire
DAQ, though more can be supported if needed.</p>
<p>The syntax for defining a module is</p>
<div class="highlight-python"><pre>BASE_ADDRESS {type string} {VME Address} {Board ID} {Crate int} {board int}</pre>
</div>
<p>The definitions of these are as follows.</p>
<blockquote>
<div><ul class="simple">
<li>BASE_ADDRESS tells the parser that it found a board definition.</li>
<li>{type string} gives the type of the board. At the moment only
the types &#8216;V1724&#8217; or &#8216;V2718&#8217; are supported.</li>
<li>{Board ID} is a unique identification number for the board.
Each board has a serial number printed on the front and it is
recommended to use that.</li>
<li>{Crate int} is the crate number assigned in the corresponding LINK command.</li>
<li>{board int} is zero for boards hooked up via daisy chain (since
each is defined as its own crate). For readout through the
crate controller each board on a crate is given a unique int
starting at zero.</li>
</ul>
</div></blockquote>
<p>The following is an example initialization using two slave PCs. One
slave (number two) has two digitizers and a crate controller hooked up
via separate links on an A3818. The other slave (number one) has a
single digitizer only.</p>
<div class="highlight-python"><pre>#Slave ID 2
%2LINK V2718 0 1 # -- Digitizer Link
%2LINK V2718 0 0 # -- Digitizer Link
%2LINK V2718 1 0 # -- Crate Controller Link
%2BASE_ADDRESS  V1724 32100000 876 1 0 # -- Digitizer
%2BASE_ADDRESS  V1724 22230000 770 0 0 # -- Digitizer
%2BASE_ADDRESS  V2718 EE000000 1868 0 1 # -- Crate Controller

#Slave ID 1
%1LINK V2718 0 0 # -- Digitizer Link
%1BASE_ADDRESS V1724 22240000 749 0 0 # -- Digitizer</pre>
</div>
<p>For standalone deployments containing only one slave, the &#8216;%n&#8217;
identifier must be removed. This is because for a standalone
deployment the options file is not run through the parser that removes
and strips this identifier.</p>
</div>
<div class="section" id="run-options">
<h2>Run Options<a class="headerlink" href="#run-options" title="Permalink to this headline">¶</a></h2>
<p>The user can define several options related to the run. These are
options for kodiaq itself. To control the board internal options, see
the section on board options.</p>
<blockquote>
<div><ul class="simple">
<li><strong>BLT_SIZE {int}</strong>
Size of a block transfer. The default is the maximum size of
524288 bytes. There is probably no reason to change this.</li>
<li><strong>RUN_START {int} {int}</strong>
Define how a run is started. 0 means via VME register and 1 means
via s-in. Option 1 should always be used if you have multiple
digitizers as it synchronizes the clocks of the digitizers. The
second option is ignored if the first argument is set to zero (but must
still be provided). If the first argument is set to one the board
ID of the crate controller that will be used to start the run
must be provided as the second argument.</li>
<li><strong>BASELINE_MODE {int}</strong>
kodiaq contains an automated routine to adjust the
baselines so that the full dynamic range of each input channel is
used. This option lets the user set when that should happen.
Giving the argument &#8216;0&#8217; means the baselines are not determined.
They are set via the values given in the files in
src/slave/baselines. The argument &#8216;1&#8217; tells the program to
automatically determine baselines whenever the DAQ is armed. It
is forseen to add an option to have the baselines recalibrated every
hour or so without stopping the run, however this option does not
exist yet.</li>
<li><strong>SUM_MODULE {int}</strong>
It is anticipated to run with one digitizer recording the
attenuated sum of all channels, a clock, and some NIM signals.
These channels should be flagged for special processing by the
event builder. This is done with this option. Note if you want to
flag more than one digitizer, just put a second SUM_MODULE option
in (do not make one with two arguments as the second will be
ignored).</li>
<li><strong>DDC10_OPTIONS {string} {int0} {int1} ... {int 14}</strong>
If a DDC10 high energy veto module is used, this line lets you
define the options. There is one string followed by fifteen
integer arguments. A detailed explanation of the arguments
appears in the documentation for the custom ddc10 firmware. The arguments are:
* string: address of the module (ip)
* int0: sign
* int1: integration window
* int2: veto delay
* int3: signal threshold
* int4: integration threshold
* int5: width cut
* int6: rise time cut
* int7: component status
* int8-int11: 4 parameters for veto function (see ddc10 docs)
* int12: outer ring factor
* int13: inner ring factor
* int14: prescaling</li>
</ul>
</div></blockquote>
<p>An example of how these options appears in the .ini file is shown below.</p>
<div class="highlight-python"><pre>## BLT_SIZE {int}
##     Usage: define block transfer size
BLT_SIZE 524288

## RUN_START {int} {int}
##      Usage: define run start mode (0 - board internal 1-s-in)
##             and run start module by ID (module must be defined)
RUN_START 1 1868

## SUM_MODULE {int}
##      Usage: define a sum module by ID. This module will always be
##             digitized and will not be included in the event builder
SUM_MODULE 991

## DDC10_Options {string0} {int0} ... {int 14}
##      Usage: Define options for the ddc10 veto module
##             {string0}:  ADDRESS
##             {int0} Sign {int1} Integration Window {int2} VETO DELAY
##             {int3} Signal Threshold {int4} Integration Threshold
##             {int5} Width Cut {int6} Rise time cut {int7} Component status
##             {int8-11} Par[0-3] {int12} Outer ring factor
##             {int13} Inner ring factor {int14} Prescaling
DDC10_OPTIONS 130.92.139.240  1 100 200 150 20000 50 30 1 0 0 0 50 2 1 1000

## BASELINE_MODE {int}
##     Usage: 0 - no baselines determined. read from file if available.
##            1 - try to automatically determine baselines each time
##                boards are armed
BASELINE_MODE 1</pre>
</div>
</div>
<div class="section" id="output-options">
<h2>Output Options<a class="headerlink" href="#output-options" title="Permalink to this headline">¶</a></h2>
<p>The output options all relate to where the data is pushed to. Not all
of these options are required, but be sure to include the options
related to your chosen write mode.</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><strong>WRITE_MODE {int}</strong>
Define what is done with the data. 0 - no writing (test mode). 1
- write to file (not yet supported). 2 - write to mongodb. If you
choose mode &#8216;2&#8217;, make sure the MONGO_OPTIONS are defined.</li>
<li><strong>MONGO_OPTIONS {string1} {string2} {int1} {int2} {int3} {int4}</strong>
Define the mongo linkage. This one is a bit more complicated and
will be explained in detail.<ul>
<li>{string1} gives the address of the PC running the mongodb database.
This can be either a hostname or an ip address.</li>
<li>{string2} defines a collection name for the data. The format of this
is {dbname}.{collectionname}. The database name must be provided.
If you provide a static collection name all data will be
written to the same collection. Replacing the collection name with
a &#8216;*&#8217; character will put each run in its own collection,
dynamically named based and the date and time the run is started.
<em>Example:</em> &#8216;data.pmtdata&#8217; puts the data in database &#8216;data&#8217; and
collection &#8216;pmtdata&#8217; while &#8216;data.*&#8217; puts the data in database
&#8216;data&#8217; but creates a new collection every run with form
data_YYMMDD_HHMM.</li>
<li>{int1} defines the compression mode. All data will be
transferred to mongodb over the network so it is usually
advantageous to compress it first. kodiaq uses snappy, which
compresses the data by about 50% at a few hundres MB/s. Setting
this value to 0 means no compression while 1 turns on
compression. Whether or not the data is compressed is communicated to
the event builder via the run attributes document (see the protocols
section).</li>
<li>{int2} gives the min insert size. kodiaq uses bulk inserts to
put data into mongodb. This means each insert is actually a vector of
BSON documents. An insert must exceed this size before being
put in the database. Size is in bytes.</li>
<li>{int3} defines the write concern for mongo. Putting this to
normal mode (set 0) turns write concern on. This means the client will
wait for a reply from the mongo database after writing. On the
one hand, this is very good since it confirms an insert made it to
mongo. On the other hand it is very slow. Turning the option of (value
1) is required for high-rate data-taking.</li>
</ul>
</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first"><strong>PROCESSING_OPTIONS {int} {int} {int}</strong>
The first int defines how many parallel threads should be used for data
processing. It isn&#8217;t suggested to make this a ridiculous number. The
boards can only be read one at a time (there is a mutex-protected call
to the CAEN block transfer function). The goal at high rates is to
have the boards always being read. Therefore enough processing threads
(and processing power) must exist to do all of the data parsing, BSON
creation, and data input. As a rule this number is usually set based
on the number of threads in the processor on the computer.
The second int defines the block splitting mode. This is a
reformatting of the data before it is put into the database. The
options are:</p>
<blockquote>
<div><ul class="simple">
<li>0 - No block splitting. Each mongodb document will contain an
entire block transfer which could contain one or many event headers.</li>
<li>1 - coarse block splitting. Splits the block into separate
events. This is for the default board firmware where each
event is a trigger. One mongodb document contains data from
all the channels for this trigger.</li>
<li>2 - fine block splitting. Splits the block
into separate events. Then further splits the events into occurrences (only
works if zero length encoding is set on via VME option). This means each
zero-length-encoded chunk of data is its own doc. This mode
only works with the default firmware and is meant to emulate
the custom firmware.</li>
<li>3 - header extraction for custom firmware. Not yet implemented.</li>
</ul>
</div></blockquote>
<p>The third int is the readout threshold. This defines a minimum
number of documents that must be read before being inserted into
mongodb. Can be tuned to achieve maximum write speeds in cases
where rates fluctuate. At the end of a run the entire buffer will
be written out regardless of whether this threshold was reached or not.</p>
</li>
<li><p class="first"><strong>OUTFILE_OPTIONS {string} {int} {int}</strong>
This defines options for file output. The string argument defines
the path. Using a wildcard (*) at the end of the string only will
cause the end of the filename to be dynamically generated based on
time and date. Please don&#8217;t put a wildcard anywhere except the end
of the string. The first integer defines the compression (0-off
1-snappy). The second int defines the number of events per file.
The software only supports up to 10,000 files per run so don&#8217;t
make this too huge (the last file will just get all the data if
this number is overrun). Writing -1 means all data in one file.</p>
</li>
</ul>
</div></blockquote>
<p>An example of how these options appear in the .ini file is shown
below.</p>
<div class="highlight-python"><pre>## WRITE_MODE {int}
##     Usage: define write mode. 0-no writing 1-to file 2-mongodb
WRITE_MODE 2

## MONGO_OPTIONS {string} {string} {int} {int} {int}
##     Usage: first string mongodb address
##            second string collection name
##            first int 0-do not zip output 1-zip output
##            second int {int} max insert size
##            third int {int} write concern (0-normal 1-off)
MONGO_OPTIONS lheppc42 data.test 1 5000 1

## PROCESSING_OPTIONSS {int} {int} {int}
##     Usage: define the number of processing threads. program will
##            assign one by default if this number is not set or is garbage
##            second int defined the processing mode (0-none, 1-coarse,
##            2-occurrence building old fw)
##            third int is readout threshold (how many BLTs before
##            board says it is ready to be read)
PROCESSING_OPTIONS 6 2 1

## OUTFILE_OPTIONS {string} {int} {int}
##     Usage: define options for file output. The first string argument
##            is the path. A wildcard means to end the file name with
##            a number determined by the current date/time.
##            The first int is used to define the compression. 1-on 0-off
##            The second int defines the number of events per file. -1
##            means unlimited.
OUTFILE_OPTIONS koData* 1 5000</pre>
</div>
</div>
<div class="section" id="vme-options">
<h2>VME Options<a class="headerlink" href="#vme-options" title="Permalink to this headline">¶</a></h2>
<p>The VME options allow setting of the VME registers in the V1724
modules. This allows direct control of the acquisition system. Some of
these settings are absolutely required to remain at their default
values, others can be tuned based on the desired performance of the
DAQ. Please only change these values if you know what you are doing.
Problems with incorrect settings in these registers are very hard to
debug.</p>
<p>Two things should be kept in mind:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The VME options are loaded to the boards in the order they are
listed in the .ini file.</li>
<li>Absolutely no sanity checking is done on these options. The
value passed as an argument will be directly set to the
digitizers.</li>
</ol>
</div></blockquote>
<p>The general format of a VME option setting is as follows:</p>
<div class="highlight-python"><pre>WRITE_REGISTER {reg} {val} {boardID} {crateID} {linkID}</pre>
</div>
<p>Where the values of the parameters are:</p>
<blockquote>
<div><ul class="simple">
<li><strong>WRITE_REGISTER</strong> is the lag that tells the file parser that
this is a VME setting.</li>
<li><strong>{reg}</strong> is a hexidecimal value of the register to set. These
are sixteen-bit (four word) values and are added to the board
VME address to write to a specific memory register of a specific board.</li>
<li><strong>{boardID}</strong> is an ID number of a board in case it is desired
to write the option just to a single board. -1 means all boards.</li>
<li><strong>{crateID}</strong> is an ID number of a crate, should be combined
with linkID to write to all boards with a specific link and crate. -1
means all.</li>
<li><strong>{linkID}</strong> is an ID number of a link. Should be combined with
crateID to write to all boards with a specific link and crate. -1 for
all.</li>
</ul>
</div></blockquote>
<p>Here are a few examples of how to use the command.</p>
<p>To write the value of 10 to register EF00 for all boards:</p>
<div class="highlight-python"><pre>WRITE_REGISTER EF00 10 -1 -1 -1</pre>
</div>
<p>To write the same value to the same register only for board 800:</p>
<div class="highlight-python"><pre>WRITE_REGISTER EF00 10 800 -1 -1</pre>
</div>
<p>To write the same value to the same register for crate 2 on link 0 of
slave number one:</p>
<div class="highlight-python"><pre>%1WRITE_REGISTER EF00 10 -1 2 0</pre>
</div>
<p>Generally, the same options should be written to all digitizers so
setting the board, crate, and link IDs to -1 is advisable. The
exception to this is the acquisition monitor board, which may require
some special settings.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Daniel Coderre.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>