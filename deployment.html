
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Deployment of the Full System &mdash; kodiaq 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="kodiaq 0.9 documentation" href="index.html" />
    <link rel="next" title="DAQ Options" href="options.html" />
    <link rel="prev" title="Using the Client Program" href="usage.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">
        kodiaq</a>
      <span class="navbar-text navbar-version pull-left"><b>0.9</b></span>
    </div>
    
    <div class="collapse navbar-collapse"><!-- nav-collapse">-->
      <ul class="nav navbar-nav pull-right">
        <!--<li class="divider-vertical"></li>  -->
        
        
        
        
         
            

<li>
    <a href="usage.html" title="Previous Chapter: Using the Client Program"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Using the Client...</span>
    </a>
  </li>
  <li>
    <a href="options.html" title="Next Chapter: DAQ Options"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">DAQ Options &raquo;</span>
    </a>
  </li>
          
        
        
        
        
      </ul>
      
      <!--          
		    
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
		     -->
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinterface.html">A Tour of the Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of the client UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Client Program</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Deployment of the Full System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary-of-dependencies-per-module">Summary of Dependencies per Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-step-by-step">Deployment, Step by Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="#koslave">koSlave</a></li>
<li class="toctree-l2"><a class="reference internal" href="#komaster">koMaster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-modes">Run Modes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-of-the-standalone-reader-module">Deployment of the Standalone Reader Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="options.html">DAQ Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">Data Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="jargon.html">Jargon Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>

<!--<li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#scope-of-the-program">Scope of the program</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#use-guidelines">Use Guidelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="webinterface.html">A Tour of the Web Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="webinterface.html#introduction">Introduction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of the client UI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#fetching-the-source-code">Fetching the source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#compiling-the-ui-module">Compiling the UI module</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#running-the-code">Running the code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Client Program</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#logging-in">Logging In</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#daq-status-window">DAQ Status window</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#control-window">Control Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#messages-window">Messages Window</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Deployment of the Full System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary-of-dependencies-per-module">Summary of Dependencies per Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-step-by-step">Deployment, Step by Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="#koslave">koSlave</a></li>
<li class="toctree-l2"><a class="reference internal" href="#komaster">koMaster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-modes">Run Modes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-of-the-standalone-reader-module">Deployment of the Standalone Reader Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="options.html">DAQ Options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="options.html#general-syntax">General Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#electronics-definitions">Electronics Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#run-options">Run Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#output-options">Output Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#vme-options">VME Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">Data Formats</a><ul>
<li class="toctree-l2"><a class="reference internal" href="protocols.html#output-to-mongodb">Output to Mongodb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="protocols.html#run-control-document">Run Control Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="protocols.html#data-documents">Data Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="protocols.html#data-format">Data Format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jargon.html">Jargon Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>
</ul>
</li> -->
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="deployment-of-the-full-system">
<h1>Deployment of the Full System<a class="headerlink" href="#deployment-of-the-full-system" title="Permalink to this headline">¶</a></h1>
<p>kodiaq consists of three parts:</p>
<ul class="simple">
<li>The master module runs on one computer and manages the entire system</li>
<li>Slave modules run on each readout PC and drive the boards</li>
<li>User modules are used to log into the master and steer the DAQ</li>
</ul>
<p>All of these modules are required for running. Installation and
configuration of the modules will be described in this section.</p>
<p>All three modules require the libkodiaq, which is compiled
automatically no matter which modules are added. The libkodiaq library contains
shared code for the network protocols, options file handling, logging,
and other assorted helper functions. The source for this library is
found in src/common.</p>
<p>Building the software is done using autotools. Line-by-line
instructions are given below for each module, however in general the
software is simply compiled by calling:</p>
<div class="highlight-python"><pre>./configure
make</pre>
</div>
<p>Some of the modules have unique dependencies not shared by the others.
For example the master and slave modules require the mongodb driver
while the user does not. End users may not want to install mongodb
just to use the DAQ UI. Therefore the configure script has several
flags that tell kodiaq which modules to include.</p>
<table border="1" class="table-hover docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>{no arguments}</td>
<td>Compile the user module only</td>
</tr>
<tr class="row-odd"><td>&#8211;disable-user</td>
<td>Do not compile the user module</td>
</tr>
<tr class="row-even"><td>&#8211;enable-slave</td>
<td>Compile the slave module</td>
</tr>
<tr class="row-odd"><td>&#8211;enable-master</td>
<td>Compile the master module</td>
</tr>
<tr class="row-even"><td>&#8211;enable-ddc10</td>
<td>Enable ddc-10 support for master</td>
</tr>
<tr class="row-odd"><td>&#8211;enable-lite</td>
<td>Compile standalone slave module</td>
</tr>
</tbody>
</table>
<p>In all cases the shared common directory is compiled. For each option
enabled the configure script automatically checks that the unique
dependencies for each module are installed. The make script then
compiles only the activated modules.</p>
<div class="section" id="summary-of-dependencies-per-module">
<h2>Summary of Dependencies per Module<a class="headerlink" href="#summary-of-dependencies-per-module" title="Permalink to this headline">¶</a></h2>
<table border="1" class="table-hover docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module</th>
<th class="head">Dependencies</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>common</td>
<td><div class="first last line-block">
<div class="line">* c++ compiler (i.e. gcc)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>user</td>
<td><div class="first last line-block">
<div class="line">* libncurses-dev</div>
<div class="line">* must contain libmenu, libform, and</div>
<div class="line-block">
<div class="line">libtinfo</div>
</div>
</div>
</td>
</tr>
<tr class="row-even"><td>slave/lite</td>
<td><div class="first last line-block">
<div class="line">* libpthread-dev</div>
<div class="line">* libCAENVME</div>
<div class="line">* libsnappy-dev</div>
<div class="line">* libmongoclient (if mongodb output</div>
<div class="line-block">
<div class="line">is required)</div>
</div>
<div class="line">* libprotobuf-dev</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>master</td>
<td><div class="first last line-block">
<div class="line">* libmongoclient (if mongodb output</div>
<div class="line-block">
<div class="line">is required)</div>
</div>
</div>
</td>
</tr>
<tr class="row-even"><td>ddc10</td>
<td><div class="first last line-block">
<div class="line">* libtcl8.5</div>
<div class="line">* libexpect</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="deployment-step-by-step">
<h2>Deployment, Step by Step<a class="headerlink" href="#deployment-step-by-step" title="Permalink to this headline">¶</a></h2>
<p>Here is a general outline of the steps needed to deploy a system. More
specific information on each step will be found in later sections.</p>
<ol class="arabic simple">
<li>Hook up the hardware. A readout PC (from now on called a slave)
needs a CAEN A2818 or A3818 PCI(e) card. Up to 8 digitizers can
be hooked up via optical link. You also need one V2718 crate
controller with output &#8216;0&#8217; fanned to the s-in of all digitizers.</li>
<li>Install the koSlave module on each slave PC. Start the daemon in
a detached screen.</li>
<li>Find a spot for the master module to live. It is suggested to
use an independent PC as dispatcher but also possible to install
it alongside a slave. Install the master here. Make sure the
linkage between master and slave is defined correctly. Start the
master daemon in a detached screen.</li>
<li>Write your options file. Use the default as a base. You will
need to define the physical electronics setup exactly.</li>
<li>Log into the UI and start the DAQ!</li>
</ol>
<p>The specifics on installing the slave and master, as well as how to
write an options file are given in the next sections.</p>
</div>
<div class="section" id="koslave">
<h2>koSlave<a class="headerlink" href="#koslave" title="Permalink to this headline">¶</a></h2>
<p>The kodiaq slave module is the meat of the acquisition system. It
contains all the classes for controlling the V1724 digitizers as well
as pushing the data stream to mongodb. The koSlave module is a daemon
that runs all the time and listens for connections to the master.</p>
<p>There are several dependencies that must be met for the slave module
to work.</p>
<ul>
<li><dl class="first docutils">
<dt>You need a PC with a CAEN A2818 or A3818 PCI(-e) card installed</dt>
<dd><p class="first last">and also the proper drivers.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>There are several library dependencies</dt>
<dd><ul class="first last simple">
<li>CAENVMElib (available from CAEN, this is a closed-source
library)</li>
<li>mongodb greater than version 2.55 (earlier versions can work with
a slight modification to the source code). Specifically
lbmongoclient is needed.</li>
<li>libsnappy for on-the-fly compression</li>
<li>libpthread for parallel processing</li>
<li>Google protocol buffers libraries (called libprotobuf-dev on
ubuntu)</li>
<li>libpbf for file output</li>
<li>Normal build libraries (build-essential package on ubuntu)</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to compile without libmongoclient and/or libprotobuf/libpbf. If you compile without libmongoclient you will not be able to output to a mongodb. If you compile without libprotobuf or libpbf you will not be able to write to file. Depending on your installation one of these may be fine. You will be notified at the end of the configure script which output forms are available on your system.</p>
</div>
<p>Checkout the code from github. To compile use the following steps:</p>
<div class="highlight-python"><pre>cd kodiaq (top-level directory)
./configure --enable-slave (optionally --disable-user if the UI is not needed)
make</pre>
</div>
<p>The connection to the master must also be defined. Right now this is
hard-coded in the koSlave.cc file. The line
fNetworkInterface.Initialize(...) must be edited to give the proper
address of the master. It is forseen to put this in a config file.</p>
<p>To start the slave just run koSlave, preferably in a detached screen.
The program will automatically scan the master and check to see if
it puts the network up. If so the slave will connect automatically.</p>
<p>In case that the slave loses connection it will stop the DAQ and
return to this idle state, waiting for another connection to the
master. It should be fine just to leave it on indefinitely if there
are no crashes.</p>
</div>
<div class="section" id="komaster">
<h2>koMaster<a class="headerlink" href="#komaster" title="Permalink to this headline">¶</a></h2>
<p>The master should be installed somewhere with a reliable network
connection to the slaves. It can also run on a slave PC if necessary
since it uses very few resources. Two open ports are required for
communication with slaves and two more for communication with clients.
These can be any ports but they must be defined in koSlave and in the
UI.</p>
<p>To install the master, mongodb must be installed (libmongoclient).
Additionally, if support for configuring the DDC-10 high energy veto
module is required then libddc is also needed.</p>
<p>To build use the following:</p>
<div class="highlight-python"><pre>cd kodiaq
./configure --enable-master (--enable-ddc10 for ddc10 support)
make</pre>
</div>
<p>The executable is in src/master/koMaster. This should also be run in a
detached screen and can be left on more or less indefinitely unless
there are issues.</p>
<p>The DDC-10 module uses telnet and requires libtcl8.5 and libexpect.</p>
<div class="section" id="run-modes">
<h3>Run Modes<a class="headerlink" href="#run-modes" title="Permalink to this headline">¶</a></h3>
<p>The operational modes for the DAQ are defined in
src/master/data/RunModes.ini. This file is simply a list where the
first entry is a string with a run mode identifier and the second
entry is the path to the .ini file for that mode. This file can be
edited while the master is running. For an exampe .ini file take a
look in src/master/data/RunModes/DAQOptionsMaster.ini.</p>
</div>
</div>
<div class="section" id="deployment-of-the-standalone-reader-module">
<h2>Deployment of the Standalone Reader Module<a class="headerlink" href="#deployment-of-the-standalone-reader-module" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to deploy a standalone module for running small
DAQ systems. This consists of the slave module which is steered via a
text-based interface on the console.</p>
<p>To deploy the standalone module, make sure all the same dependencies are met as
for the slave module described previously. Then build using the
following commands:</p>
<div class="highlight-python"><pre>cd kodiaq
./configure --enable-lite
make</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As with the slave module, the lite module will automatically detect if you have libmongoclient (for mongodb output) and libpbf/libprotobuf (for file output). If you are missing these libraries certain output modes will be unavailable. You will be informed at the end of the configure script which output modes have been found on your system.</p>
</div>
<p>Assuming you are successful, the koSlave executable should be
installed with a special flag that allows local operation. To operate
this module, use the script in the klite directory:</p>
<div class="highlight-python"><pre>cd klite
./StartDAQ.sh</pre>
</div>
<p>This will start the DAQ with the options defined in
klite/DAQConfig.ini. Please note that editing of the DAQConfig.ini
file is intended for expert users only. The available parameters in
this file are described later in this documentation.</p>
<p>The lite program has only two options. The DAQ is started with the &#8216;s&#8217;
key. Pressing the &#8216;q&#8217; key at any time will shut down the DAQ and stop
the program.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Daniel Coderre.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>